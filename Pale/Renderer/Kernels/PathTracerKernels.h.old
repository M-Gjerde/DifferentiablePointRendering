//
// Created by magnus on 8/29/25.
//

#include <sycl/sycl.hpp>
#include "Renderer/GPUDataStructures.h"

namespace Pale {
    class PathTracerMeshKernel {
    public:
        PathTracerMeshKernel(
        GPUSceneBuffers scene,
        SensorGPU sensors
        ) : m_scene(scene), m_sensor(sensors) {
        }


         void operator()(sycl::item<1> item) const {
                uint32_t id = item.get_linear_id();
                traceOnePhoton(id, 0);
                m_sensor.framebuffer[id] = 1.3f;

           }


        /*
        SYCL_EXTERNAL static bool intersectBLASMesh(const Ray &rayO, uint32_t geomIdx, Hit &out, const SceneDesc &scene);
        SYCL_EXTERNAL static bool intersectBLASQuadric(const Ray &rayO, uint32_t geomIdx, Hit &out, const SceneDesc &scene);

        SYCL_EXTERNAL static bool intersectScene(const Ray &rayW, Hit *hit, const SceneDesc &scene);


        //float traceVisibility(const Ray &rayIn, float tMax, const SceneDesc &scene, PCG32& rng) const;

        */
        SYCL_EXTERNAL void traceOnePhoton(uint64_t photonID, uint32_t totalPhotonCount) const;
    private:
        GPUSceneBuffers m_scene;
        SensorGPU m_sensor;
    };
}
